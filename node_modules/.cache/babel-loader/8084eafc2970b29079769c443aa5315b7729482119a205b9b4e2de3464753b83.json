{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useParams,Link}from'react-router-dom';import{supabase}from'../client';import{useNavigate}from'react-router-dom';import'./DetailView.css';import{formatDistanceToNow}from'date-fns';// used to display the distance between a given date and the current time in words\nimport{jsxs as _jsxs,jsx as _jsx}from\"react/jsx-runtime\";const DetailView=()=>{const{id}=useParams();const[post,setPost]=useState({});const[count,setCount]=useState(0);const[comment,setComment]=useState(\"\");const[comments,setComments]=useState([]);const navigate=useNavigate();// Fetch the post with the given id\nuseEffect(()=>{const fetchPost=async()=>{const{data}=await supabase.from('Posts').select().eq('id',id).single();if(data){setPost(data);}else{console.error('Failed to fetch post data');}};fetchPost();},[id]);// Fetch the upvotes for the post\nuseEffect(()=>{const fetchCount=async()=>{const{data}=await supabase.from('Posts').select('upvotes').eq('id',id).single();if(data){setCount(data.upvotes);}else{console.error('Failed to fetch upvotes');}};fetchCount();},[id]);// Update the upvotes for the post\nconst updateCount=async event=>{event.preventDefault();await supabase.from('Posts').update({upvotes:count+1}).eq('id',id);setCount(count=>count+1);};// Delete the post\nconst deletePost=async event=>{event.preventDefault();await supabase.from('Posts').delete().eq('id',id);setTimeout(()=>{navigate(\"/read\");},1000);};// Fetch the comments for the post\nuseEffect(()=>{const fetchComments=async()=>{const{data}=await supabase.from('Comments').select().eq('postId',id);if(data){setComments(data);}else{console.error('Failed to fetch comments');}};fetchComments();},[id]);// Submit a comment\nconst submitComment=async event=>{event.preventDefault();if(!comment.trim())return;// Insert comment\nconst insertResponse=await supabase.from('Comments').insert([{postId:id,comment:comment}]);// Fetch comments after insertion\nconst selectResponse=await supabase.from('Comments').select().eq('postId',id);setComments(selectResponse.data);setComment(\"\");// Clear comment field\n};return/*#__PURE__*/_jsxs(\"div\",{className:\"DetailView\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"row1\",children:[post.created_at&&/*#__PURE__*/_jsxs(\"p\",{children:[\"Posted \",formatDistanceToNow(new Date(post.created_at),{addSuffix:true})]}),/*#__PURE__*/_jsx(Link,{to:\"/edit/\".concat(id),children:/*#__PURE__*/_jsx(\"button\",{children:\" \\uD83D\\uDD8B\\uFE0F\"})}),/*#__PURE__*/_jsx(\"button\",{onClick:deletePost,children:\" \\uD83D\\uDDD1\\uFE0F\"})]}),/*#__PURE__*/_jsx(\"h2\",{children:\"Title: \"+post.title}),post.image&&/*#__PURE__*/_jsx(\"img\",{src:post.image,alt:post.title}),/*#__PURE__*/_jsx(\"p\",{children:\"Author: \"+post.author}),/*#__PURE__*/_jsx(\"p\",{children:\"Description: \"+post.description}),/*#__PURE__*/_jsxs(\"button\",{id:\"up\",onClick:updateCount,children:[\"\\uD83D\\uDC4D \",count,\" upvotes\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"comments\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Comments\"}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"ul\",{children:comments.map((current_element,index)=>/*#__PURE__*/_jsx(\"li\",{children:current_element.comment},index))})}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:submitComment,children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:comment,onChange:e=>setComment(e.target.value),placeholder:\"Write a comment...\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"Submit Comment\"})]})]})]});};export default DetailView;","map":{"version":3,"names":["React","useState","useEffect","useParams","Link","supabase","useNavigate","formatDistanceToNow","jsxs","_jsxs","jsx","_jsx","DetailView","id","post","setPost","count","setCount","comment","setComment","comments","setComments","navigate","fetchPost","data","from","select","eq","single","console","error","fetchCount","upvotes","updateCount","event","preventDefault","update","deletePost","delete","setTimeout","fetchComments","submitComment","trim","insertResponse","insert","postId","selectResponse","className","children","created_at","Date","addSuffix","to","concat","onClick","title","image","src","alt","author","description","map","current_element","index","onSubmit","type","value","onChange","e","target","placeholder"],"sources":["C:/Users/rithi/OneDrive/Desktop/web stack/final - Copy/client/src/pages/DetailView.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useParams, Link } from 'react-router-dom';\r\nimport { supabase } from '../client';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport './DetailView.css';\r\nimport { formatDistanceToNow } from 'date-fns'; // used to display the distance between a given date and the current time in words\r\n\r\nconst DetailView = () => {\r\n  const { id } = useParams();\r\n  const [post, setPost] = useState({});\r\n  const [count, setCount] = useState(0);\r\n  const [comment, setComment] = useState(\"\");\r\n  const [comments, setComments] = useState([]);\r\n  const navigate = useNavigate();\r\n\r\n  // Fetch the post with the given id\r\n  useEffect(() => {\r\n    const fetchPost = async () => {\r\n      const { data } = await supabase\r\n        .from('Posts')\r\n        .select()\r\n        .eq('id', id)\r\n        .single();\r\n  \r\n      if (data) {\r\n        setPost(data);\r\n      } else {\r\n        console.error('Failed to fetch post data');\r\n      }\r\n    };\r\n  \r\n    fetchPost();\r\n  }, [id]);\r\n\r\n  // Fetch the upvotes for the post\r\n  useEffect(() => {\r\n    const fetchCount = async () => {\r\n      const { data } = await supabase\r\n        .from('Posts')\r\n        .select('upvotes')\r\n        .eq('id', id)\r\n        .single();\r\n  \r\n      if (data) {\r\n        setCount(data.upvotes);\r\n      } else {\r\n        console.error('Failed to fetch upvotes');\r\n      }\r\n    };\r\n  \r\n    fetchCount();\r\n  }, [id]);\r\n\r\n  // Update the upvotes for the post\r\n  const updateCount = async (event) => {\r\n    event.preventDefault();\r\n\r\n    await supabase\r\n      .from('Posts')\r\n      .update({ upvotes: count + 1 })\r\n      .eq('id', id);\r\n\r\n    setCount((count) => count + 1);\r\n  };\r\n\r\n  // Delete the post\r\n  const deletePost = async (event) => {\r\n    event.preventDefault();\r\n    await supabase\r\n    .from('Posts')\r\n    .delete()\r\n    .eq('id', id);\r\n    setTimeout(() => {\r\n      navigate(\"/read\");\r\n    }, 1000);  };\r\n\r\n  // Fetch the comments for the post\r\n  useEffect(() => {\r\n    const fetchComments = async () => {\r\n      const { data } = await supabase\r\n        .from('Comments')\r\n        .select()\r\n        .eq('postId', id);\r\n  \r\n      if (data) {\r\n        setComments(data);\r\n      } else {\r\n        console.error('Failed to fetch comments');\r\n      }\r\n    };\r\n  \r\n    fetchComments();\r\n  }, [id]);\r\n\r\n  // Submit a comment\r\n  const submitComment = async (event) => {\r\n    event.preventDefault();\r\n    if (!comment.trim()) return;\r\n\r\n    // Insert comment\r\n    const insertResponse = await supabase\r\n      .from('Comments')\r\n      .insert([{ postId: id, comment: comment }]);\r\n\r\n    // Fetch comments after insertion\r\n    const selectResponse = await supabase\r\n      .from('Comments')\r\n      .select()\r\n      .eq('postId', id);\r\n    setComments(selectResponse.data);\r\n\r\n\r\n    setComment(\"\"); // Clear comment field\r\n  };\r\n\r\n  return (\r\n    <div className=\"DetailView\">\r\n      <div className=\"row1\">\r\n        {post.created_at && (\r\n          <p>Posted {formatDistanceToNow(new Date(post.created_at), { addSuffix: true })}</p>\r\n        )}\r\n        <Link to={`/edit/${id}`}><button> üñãÔ∏è</button></Link>\r\n        <button onClick={deletePost}> üóëÔ∏è</button>\r\n      </div>\r\n      <h2>{\"Title: \" + post.title}</h2>\r\n      {post.image && (<img src={post.image} alt={post.title} />)}\r\n      <p>{\"Author: \" + post.author}</p>\r\n      <p>{\"Description: \" + post.description}</p>\r\n      <button id='up' onClick={updateCount}>üëç {count} upvotes</button>\r\n      <div className=\"comments\">\r\n        <h3>Comments</h3>\r\n        <div>\r\n          <ul>\r\n            {comments.map((current_element, index) => (\r\n              <li key={index}>{current_element.comment}</li>\r\n            ))}\r\n          </ul>\r\n        </div>\r\n        <form onSubmit={submitComment}>\r\n          <input\r\n            type=\"text\"\r\n            value={comment}\r\n            onChange={(e) => setComment(e.target.value)}\r\n            placeholder=\"Write a comment...\"\r\n          />\r\n          <button type=\"submit\">Submit Comment</button>\r\n        </form>\r\n\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default DetailView;"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAClD,OAASC,SAAS,CAAEC,IAAI,KAAQ,kBAAkB,CAClD,OAASC,QAAQ,KAAQ,WAAW,CACpC,OAASC,WAAW,KAAQ,kBAAkB,CAC9C,MAAO,kBAAkB,CACzB,OAASC,mBAAmB,KAAQ,UAAU,CAAE;AAAA,OAAAC,IAAA,IAAAC,KAAA,CAAAC,GAAA,IAAAC,IAAA,yBAEhD,KAAM,CAAAC,UAAU,CAAGA,CAAA,GAAM,CACvB,KAAM,CAAEC,EAAG,CAAC,CAAGV,SAAS,CAAC,CAAC,CAC1B,KAAM,CAACW,IAAI,CAAEC,OAAO,CAAC,CAAGd,QAAQ,CAAC,CAAC,CAAC,CAAC,CACpC,KAAM,CAACe,KAAK,CAAEC,QAAQ,CAAC,CAAGhB,QAAQ,CAAC,CAAC,CAAC,CACrC,KAAM,CAACiB,OAAO,CAAEC,UAAU,CAAC,CAAGlB,QAAQ,CAAC,EAAE,CAAC,CAC1C,KAAM,CAACmB,QAAQ,CAAEC,WAAW,CAAC,CAAGpB,QAAQ,CAAC,EAAE,CAAC,CAC5C,KAAM,CAAAqB,QAAQ,CAAGhB,WAAW,CAAC,CAAC,CAE9B;AACAJ,SAAS,CAAC,IAAM,CACd,KAAM,CAAAqB,SAAS,CAAG,KAAAA,CAAA,GAAY,CAC5B,KAAM,CAAEC,IAAK,CAAC,CAAG,KAAM,CAAAnB,QAAQ,CAC5BoB,IAAI,CAAC,OAAO,CAAC,CACbC,MAAM,CAAC,CAAC,CACRC,EAAE,CAAC,IAAI,CAAEd,EAAE,CAAC,CACZe,MAAM,CAAC,CAAC,CAEX,GAAIJ,IAAI,CAAE,CACRT,OAAO,CAACS,IAAI,CAAC,CACf,CAAC,IAAM,CACLK,OAAO,CAACC,KAAK,CAAC,2BAA2B,CAAC,CAC5C,CACF,CAAC,CAEDP,SAAS,CAAC,CAAC,CACb,CAAC,CAAE,CAACV,EAAE,CAAC,CAAC,CAER;AACAX,SAAS,CAAC,IAAM,CACd,KAAM,CAAA6B,UAAU,CAAG,KAAAA,CAAA,GAAY,CAC7B,KAAM,CAAEP,IAAK,CAAC,CAAG,KAAM,CAAAnB,QAAQ,CAC5BoB,IAAI,CAAC,OAAO,CAAC,CACbC,MAAM,CAAC,SAAS,CAAC,CACjBC,EAAE,CAAC,IAAI,CAAEd,EAAE,CAAC,CACZe,MAAM,CAAC,CAAC,CAEX,GAAIJ,IAAI,CAAE,CACRP,QAAQ,CAACO,IAAI,CAACQ,OAAO,CAAC,CACxB,CAAC,IAAM,CACLH,OAAO,CAACC,KAAK,CAAC,yBAAyB,CAAC,CAC1C,CACF,CAAC,CAEDC,UAAU,CAAC,CAAC,CACd,CAAC,CAAE,CAAClB,EAAE,CAAC,CAAC,CAER;AACA,KAAM,CAAAoB,WAAW,CAAG,KAAO,CAAAC,KAAK,EAAK,CACnCA,KAAK,CAACC,cAAc,CAAC,CAAC,CAEtB,KAAM,CAAA9B,QAAQ,CACXoB,IAAI,CAAC,OAAO,CAAC,CACbW,MAAM,CAAC,CAAEJ,OAAO,CAAEhB,KAAK,CAAG,CAAE,CAAC,CAAC,CAC9BW,EAAE,CAAC,IAAI,CAAEd,EAAE,CAAC,CAEfI,QAAQ,CAAED,KAAK,EAAKA,KAAK,CAAG,CAAC,CAAC,CAChC,CAAC,CAED;AACA,KAAM,CAAAqB,UAAU,CAAG,KAAO,CAAAH,KAAK,EAAK,CAClCA,KAAK,CAACC,cAAc,CAAC,CAAC,CACtB,KAAM,CAAA9B,QAAQ,CACboB,IAAI,CAAC,OAAO,CAAC,CACba,MAAM,CAAC,CAAC,CACRX,EAAE,CAAC,IAAI,CAAEd,EAAE,CAAC,CACb0B,UAAU,CAAC,IAAM,CACfjB,QAAQ,CAAC,OAAO,CAAC,CACnB,CAAC,CAAE,IAAI,CAAC,CAAG,CAAC,CAEd;AACApB,SAAS,CAAC,IAAM,CACd,KAAM,CAAAsC,aAAa,CAAG,KAAAA,CAAA,GAAY,CAChC,KAAM,CAAEhB,IAAK,CAAC,CAAG,KAAM,CAAAnB,QAAQ,CAC5BoB,IAAI,CAAC,UAAU,CAAC,CAChBC,MAAM,CAAC,CAAC,CACRC,EAAE,CAAC,QAAQ,CAAEd,EAAE,CAAC,CAEnB,GAAIW,IAAI,CAAE,CACRH,WAAW,CAACG,IAAI,CAAC,CACnB,CAAC,IAAM,CACLK,OAAO,CAACC,KAAK,CAAC,0BAA0B,CAAC,CAC3C,CACF,CAAC,CAEDU,aAAa,CAAC,CAAC,CACjB,CAAC,CAAE,CAAC3B,EAAE,CAAC,CAAC,CAER;AACA,KAAM,CAAA4B,aAAa,CAAG,KAAO,CAAAP,KAAK,EAAK,CACrCA,KAAK,CAACC,cAAc,CAAC,CAAC,CACtB,GAAI,CAACjB,OAAO,CAACwB,IAAI,CAAC,CAAC,CAAE,OAErB;AACA,KAAM,CAAAC,cAAc,CAAG,KAAM,CAAAtC,QAAQ,CAClCoB,IAAI,CAAC,UAAU,CAAC,CAChBmB,MAAM,CAAC,CAAC,CAAEC,MAAM,CAAEhC,EAAE,CAAEK,OAAO,CAAEA,OAAQ,CAAC,CAAC,CAAC,CAE7C;AACA,KAAM,CAAA4B,cAAc,CAAG,KAAM,CAAAzC,QAAQ,CAClCoB,IAAI,CAAC,UAAU,CAAC,CAChBC,MAAM,CAAC,CAAC,CACRC,EAAE,CAAC,QAAQ,CAAEd,EAAE,CAAC,CACnBQ,WAAW,CAACyB,cAAc,CAACtB,IAAI,CAAC,CAGhCL,UAAU,CAAC,EAAE,CAAC,CAAE;AAClB,CAAC,CAED,mBACEV,KAAA,QAAKsC,SAAS,CAAC,YAAY,CAAAC,QAAA,eACzBvC,KAAA,QAAKsC,SAAS,CAAC,MAAM,CAAAC,QAAA,EAClBlC,IAAI,CAACmC,UAAU,eACdxC,KAAA,MAAAuC,QAAA,EAAG,SAAO,CAACzC,mBAAmB,CAAC,GAAI,CAAA2C,IAAI,CAACpC,IAAI,CAACmC,UAAU,CAAC,CAAE,CAAEE,SAAS,CAAE,IAAK,CAAC,CAAC,EAAI,CACnF,cACDxC,IAAA,CAACP,IAAI,EAACgD,EAAE,UAAAC,MAAA,CAAWxC,EAAE,CAAG,CAAAmC,QAAA,cAACrC,IAAA,WAAAqC,QAAA,CAAQ,qBAAI,CAAQ,CAAC,CAAM,CAAC,cACrDrC,IAAA,WAAQ2C,OAAO,CAAEjB,UAAW,CAAAW,QAAA,CAAC,qBAAI,CAAQ,CAAC,EACvC,CAAC,cACNrC,IAAA,OAAAqC,QAAA,CAAK,SAAS,CAAGlC,IAAI,CAACyC,KAAK,CAAK,CAAC,CAChCzC,IAAI,CAAC0C,KAAK,eAAK7C,IAAA,QAAK8C,GAAG,CAAE3C,IAAI,CAAC0C,KAAM,CAACE,GAAG,CAAE5C,IAAI,CAACyC,KAAM,CAAE,CAAE,cAC1D5C,IAAA,MAAAqC,QAAA,CAAI,UAAU,CAAGlC,IAAI,CAAC6C,MAAM,CAAI,CAAC,cACjChD,IAAA,MAAAqC,QAAA,CAAI,eAAe,CAAGlC,IAAI,CAAC8C,WAAW,CAAI,CAAC,cAC3CnD,KAAA,WAAQI,EAAE,CAAC,IAAI,CAACyC,OAAO,CAAErB,WAAY,CAAAe,QAAA,EAAC,eAAG,CAAChC,KAAK,CAAC,UAAQ,EAAQ,CAAC,cACjEP,KAAA,QAAKsC,SAAS,CAAC,UAAU,CAAAC,QAAA,eACvBrC,IAAA,OAAAqC,QAAA,CAAI,UAAQ,CAAI,CAAC,cACjBrC,IAAA,QAAAqC,QAAA,cACErC,IAAA,OAAAqC,QAAA,CACG5B,QAAQ,CAACyC,GAAG,CAAC,CAACC,eAAe,CAAEC,KAAK,gBACnCpD,IAAA,OAAAqC,QAAA,CAAiBc,eAAe,CAAC5C,OAAO,EAA/B6C,KAAoC,CAC9C,CAAC,CACA,CAAC,CACF,CAAC,cACNtD,KAAA,SAAMuD,QAAQ,CAAEvB,aAAc,CAAAO,QAAA,eAC5BrC,IAAA,UACEsD,IAAI,CAAC,MAAM,CACXC,KAAK,CAAEhD,OAAQ,CACfiD,QAAQ,CAAGC,CAAC,EAAKjD,UAAU,CAACiD,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAC5CI,WAAW,CAAC,oBAAoB,CACjC,CAAC,cACF3D,IAAA,WAAQsD,IAAI,CAAC,QAAQ,CAAAjB,QAAA,CAAC,gBAAc,CAAQ,CAAC,EACzC,CAAC,EAEJ,CAAC,EACH,CAAC,CAEV,CAAC,CAED,cAAe,CAAApC,UAAU","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}